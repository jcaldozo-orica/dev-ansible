---

 - name: talk to all hosts just so we can learn about them
   hosts: dev
   tasks:
     - name: Classify hosts depending on their OS distribution
       group_by:
         key: os_{{ ansible_facts['distribution'] }}

 - hosts: os_Ubuntu
   gather_facts: False
   tasks:

    #copy zscaler, root ca, sub1 ca, sub2 ca and update CA store
      - name: Download CA certificates to target hosts
        become: true
        ansible.builtin.get_url:
          url:  ${{ ZSCALERROOTCA }}
          dest: /usr/local/share/ca-certificates/zscalerRootCA.crt
      - name: Download CA certificates to target hosts
        become: true
        ansible.builtin.get_url:
          url: ${{ ZSCALERSUBCA }}
          dest: /usr/local/share/ca-certificates/zscalerSubCA.crt
      - name: Download CA certificates to target hosts
        become: true
        ansible.builtin.get_url:
          url: ${{ ORICAROOTCA }}
          dest: /usr/local/share/ca-certificates/orica_root.crt
      - name: Download CA certificates to target hosts
        become: true
        ansible.builtin.get_url:
          url: ${{ ORICASUBCA2 }}
          dest: /usr/local/share/ca-certificates/orica_sub_ca2.crt
      - name: Update CA trust store
        shell: "update-ca-certificates"
        become: true
    #configure ori.orica.net dns suffix
      - name: Install a list of packages
        become: true
        ansible.builtin.apt:
          pkg:
          - resolvconf
          state: present
      - name: add ori.orica.net suffix to resolv.conf
        become: true
        ansible.builtin.lineinfile:
          path: /etc/resolvconf/resolv.conf.d/tail
          line:  search ori.orica.net
          create: yes
      - name: update /etc/resolv.conf
        shell: "resolvconf -u"
        become: true

    #install and configure nxlog
      - name: Install a list of packages
        become: true
        ansible.builtin.apt:
          pkg:
          - nxlog-ce
          - libapr1
          - libdbi1
          state: present
      #config goes here
    #install servicenow agent

    #install crowdstrike

    #install qualys

    #install servicenow acc

    #install illumio

    #configure to allow Icinga

    #drop banner.txt, configure banner, PermitRootLogin no on /etc/ssh/sshd_config

    #configure AD login

    #configure tmux

    #configure zsh


